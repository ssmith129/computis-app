<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Computis ‚Ä¢ Contextual Anomaly Detection</title>
    <link rel="stylesheet" href="../assets/styles.css" />
    <style>
      .anomaly-flag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: help;
        position: relative;
      }
      .anomaly-flag.critical { background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
      .anomaly-flag.warning { background: rgba(251, 191, 36, 0.15); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3); }
      .anomaly-flag.info { background: rgba(59, 130, 246, 0.15); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
      
      .anomaly-tooltip {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        background: #1f2937;
        color: #e5e7eb;
        padding: 16px;
        border-radius: 8px;
        font-size: 13px;
        width: 320px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s;
        z-index: 1000;
        box-shadow: 0 10px 25px rgba(0,0,0,0.5);
      }
      .anomaly-tooltip::before {
        content: '';
        position: absolute;
        bottom: 100%;
        left: 16px;
        border: 6px solid transparent;
        border-bottom-color: #1f2937;
      }
      .anomaly-flag:hover .anomaly-tooltip {
        opacity: 1;
        pointer-events: all;
      }
      
      .resolution-actions {
        display: flex;
        gap: 8px;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid #374151;
      }
      .resolution-btn {
        flex: 1;
        padding: 6px 12px;
        border-radius: 4px;
        border: none;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .resolution-btn.primary { background: #6366f1; color: white; }
      .resolution-btn.primary:hover { background: #4f46e5; }
      .resolution-btn.secondary { background: #374151; color: #e5e7eb; }
      .resolution-btn.secondary:hover { background: #4b5563; }
      
      .transaction-row {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr 1fr 100px;
        gap: 16px;
        padding: 16px;
        border: 1px solid #2a3447;
        border-radius: 6px;
        margin-bottom: 8px;
        background: #161b26;
        align-items: center;
      }
      .transaction-row.has-anomaly {
        border-color: rgba(251, 191, 36, 0.3);
        background: rgba(251, 191, 36, 0.03);
      }
      .transaction-row.resolved {
        opacity: 0.6;
        border-color: rgba(34, 197, 94, 0.3);
      }
      
      .anomaly-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        margin-bottom: 24px;
      }
      .anomaly-stat-card {
        background: #161b26;
        border: 1px solid #2a3447;
        border-radius: 8px;
        padding: 16px;
      }
      .anomaly-stat-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        margin-bottom: 12px;
      }
      
      .filter-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
      }
      .filter-tab {
        padding: 8px 16px;
        border-radius: 6px;
        background: #161b26;
        border: 1px solid #2a3447;
        color: #9ca3af;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.2s;
      }
      .filter-tab.active {
        background: #6366f1;
        color: white;
        border-color: #6366f1;
      }
      .filter-tab:hover:not(.active) {
        background: rgba(99, 102, 241, 0.1);
        border-color: #6366f1;
      }
    </style>
  </head>
  <body>
    <header class="app-header">
      <div class="inner container">
        <a class="brand" href="index.html"><span class="logo"></span><span class="label">Computis</span></a>
        <nav class="nav">
          <a href="index.html">Dashboard</a>
          <a href="ai-confidence-chips.html">AI Confidence</a>
          <a href="audit-trail-drawer.html">Audit Trail</a>
          <a href="visual-rule-builder.html">Rule Builder</a>
          <a href="contextual-anomaly-detection.html">Anomaly Detection</a>
          <a href="multi-tenant-architecture.html">Multi-Tenant</a>
        </nav>
      </div>
    </header>
    
    <main class="container" aria-labelledby="title">
      <h1 id="title">Contextual Anomaly Detection System</h1>
      
      <section class="card" style="margin-bottom: 24px;">
        <h3>Design Element Overview</h3>
        <p style="color: #9ca3af; line-height: 1.6;">
          <strong>Problem:</strong> FMV reconciliation errors buried in CSV exports caused filing mistakes and client disputes.<br><br>
          <strong>Solution:</strong> Color-coded anomaly flags surfaced in-context with hover explainers and one-click resolution flows.<br><br>
          <strong>Impact:</strong> Anomaly detection coverage increased 150%; drastically reduced manual triage and filing errors.
        </p>
      </section>

      <div class="anomaly-stats">
        <div class="anomaly-stat-card">
          <div class="anomaly-stat-icon" style="background: rgba(239, 68, 68, 0.15); color: #ef4444;">üö®</div>
          <div style="font-size: 24px; font-weight: 600; margin-bottom: 4px;">7</div>
          <div style="font-size: 13px; color: #9ca3af;">Critical Issues</div>
        </div>
        <div class="anomaly-stat-card">
          <div class="anomaly-stat-icon" style="background: rgba(251, 191, 36, 0.15); color: #fbbf24;">‚ö†Ô∏è</div>
          <div style="font-size: 24px; font-weight: 600; margin-bottom: 4px;">15</div>
          <div style="font-size: 13px; color: #9ca3af;">Warnings</div>
        </div>
        <div class="anomaly-stat-card">
          <div class="anomaly-stat-icon" style="background: rgba(59, 130, 246, 0.15); color: #3b82f6;">‚ÑπÔ∏è</div>
          <div style="font-size: 24px; font-weight: 600; margin-bottom: 4px;">23</div>
          <div style="font-size: 13px; color: #9ca3af;">Info Flags</div>
        </div>
        <div class="anomaly-stat-card">
          <div class="anomaly-stat-icon" style="background: rgba(34, 197, 94, 0.15); color: #22c55e;">‚úì</div>
          <div style="font-size: 24px; font-weight: 600; margin-bottom: 4px;">182</div>
          <div style="font-size: 13px; color: #9ca3af;">Resolved</div>
        </div>
      </div>

      <section class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h3>Transactions with Anomalies</h3>
          <div class="filter-tabs">
            <div class="filter-tab active" onclick="filterAnomalies('all')">All</div>
            <div class="filter-tab" onclick="filterAnomalies('critical')">Critical</div>
            <div class="filter-tab" onclick="filterAnomalies('warning')">Warnings</div>
            <div class="filter-tab" onclick="filterAnomalies('info')">Info</div>
          </div>
        </div>

        <div id="transactions-list">
          <div class="transaction-row has-anomaly" data-severity="critical">
            <div>
              <div style="font-weight: 500;">BTC Sale on Coinbase</div>
              <div style="font-size: 13px; color: #9ca3af;">0.5 BTC ‚Üí $22,450 on 2024-01-15</div>
            </div>
            <div>$22,450</div>
            <div><span class="badge">Sale</span></div>
            <div>
              <div class="anomaly-flag critical">
                üö® FMV Mismatch
                <div class="anomaly-tooltip">
                  <strong style="color: #ef4444;">Critical: Fair Market Value Discrepancy</strong>
                  <div style="margin: 8px 0; line-height: 1.5;">
                    Transaction price ($44,900/BTC) differs significantly from market rate ($42,200/BTC) at time of sale.
                    <br><br>
                    <strong>Possible causes:</strong><br>
                    ‚Ä¢ Price manipulation<br>
                    ‚Ä¢ Incorrect exchange rate<br>
                    ‚Ä¢ Timing mismatch
                  </div>
                  <div class="resolution-actions">
                    <button class="resolution-btn primary" onclick="resolveAnomaly(this, 'accept')">Accept Price</button>
                    <button class="resolution-btn secondary" onclick="resolveAnomaly(this, 'adjust')">Adjust FMV</button>
                  </div>
                </div>
              </div>
            </div>
            <div style="text-align: right;">14:23</div>
            <div>
              <button onclick="viewDetails()" style="padding: 6px 12px; font-size: 12px;">Details</button>
            </div>
          </div>

          <div class="transaction-row has-anomaly" data-severity="critical">
            <div>
              <div style="font-weight: 500;">ETH Transfer (Unknown Wallet)</div>
              <div style="font-size: 13px; color: #9ca3af;">5.0 ETH on 2024-01-14</div>
            </div>
            <div>$11,725</div>
            <div><span class="badge warn">Transfer</span></div>
            <div>
              <div class="anomaly-flag critical">
                üö® Missing Cost Basis
                <div class="anomaly-tooltip">
                  <strong style="color: #ef4444;">Critical: No Cost Basis Found</strong>
                  <div style="margin: 8px 0; line-height: 1.5;">
                    Cannot locate original purchase records for this ETH. This will cause errors in tax calculations.
                    <br><br>
                    <strong>Next steps:</strong><br>
                    ‚Ä¢ Import historical data<br>
                    ‚Ä¢ Manual cost basis entry<br>
                    ‚Ä¢ Mark as gift/inheritance
                  </div>
                  <div class="resolution-actions">
                    <button class="resolution-btn primary" onclick="resolveAnomaly(this, 'import')">Import Data</button>
                    <button class="resolution-btn secondary" onclick="resolveAnomaly(this, 'manual')">Enter Manually</button>
                  </div>
                </div>
              </div>
            </div>
            <div style="text-align: right;">09:15</div>
            <div>
              <button onclick="viewDetails()" style="padding: 6px 12px; font-size: 12px;">Details</button>
            </div>
          </div>

          <div class="transaction-row has-anomaly" data-severity="warning">
            <div>
              <div style="font-weight: 500;">USDC ‚Üí USDT Swap (Uniswap)</div>
              <div style="font-size: 13px; color: #9ca3af;">$10,000 on 2024-01-13</div>
            </div>
            <div>$10,000</div>
            <div><span class="badge">Swap</span></div>
            <div>
              <div class="anomaly-flag warning">
                ‚ö†Ô∏è Duplicate Detected
                <div class="anomaly-tooltip">
                  <strong style="color: #fbbf24;">Warning: Possible Duplicate Transaction</strong>
                  <div style="margin: 8px 0; line-height: 1.5;">
                    Similar transaction found with matching amount and timestamp. May be imported from multiple sources.
                    <br><br>
                    <strong>Similar transactions:</strong><br>
                    ‚Ä¢ Same hash on Etherscan<br>
                    ‚Ä¢ Same timestamp ¬±5 minutes<br>
                    ‚Ä¢ Same amount and assets
                  </div>
                  <div class="resolution-actions">
                    <button class="resolution-btn primary" onclick="resolveAnomaly(this, 'merge')">Merge</button>
                    <button class="resolution-btn secondary" onclick="resolveAnomaly(this, 'keep')">Keep Both</button>
                  </div>
                </div>
              </div>
            </div>
            <div style="text-align: right;">16:42</div>
            <div>
              <button onclick="viewDetails()" style="padding: 6px 12px; font-size: 12px;">Details</button>
            </div>
          </div>

          <div class="transaction-row has-anomaly" data-severity="warning">
            <div>
              <div style="font-weight: 500;">Airdrop: MYSTERY Token</div>
              <div style="font-size: 13px; color: #9ca3af;">1,000 MYSTERY on 2024-01-12</div>
            </div>
            <div>Unknown</div>
            <div><span class="badge">Income</span></div>
            <div>
              <div class="anomaly-flag warning">
                ‚ö†Ô∏è No Pricing Data
                <div class="anomaly-tooltip">
                  <strong style="color: #fbbf24;">Warning: Token Price Unknown</strong>
                  <div style="margin: 8px 0; line-height: 1.5;">
                    Cannot determine Fair Market Value. Token not listed on major price feeds.
                    <br><br>
                    <strong>Options:</strong><br>
                    ‚Ä¢ Wait for price discovery<br>
                    ‚Ä¢ Manual valuation<br>
                    ‚Ä¢ Mark as $0 (spam token)
                  </div>
                  <div class="resolution-actions">
                    <button class="resolution-btn primary" onclick="resolveAnomaly(this, 'zero')">Mark as $0</button>
                    <button class="resolution-btn secondary" onclick="resolveAnomaly(this, 'value')">Set Value</button>
                  </div>
                </div>
              </div>
            </div>
            <div style="text-align: right;">11:20</div>
            <div>
              <button onclick="viewDetails()" style="padding: 6px 12px; font-size: 12px;">Details</button>
            </div>
          </div>

          <div class="transaction-row has-anomaly" data-severity="info">
            <div>
              <div style="font-weight: 500;">Staking Reward (Beacon Chain)</div>
              <div style="font-size: 13px; color: #9ca3af;">0.08 ETH on 2024-01-11</div>
            </div>
            <div>$187.36</div>
            <div><span class="badge">Income</span></div>
            <div>
              <div class="anomaly-flag info">
                ‚ÑπÔ∏è Tax Event
                <div class="anomaly-tooltip">
                  <strong style="color: #3b82f6;">Info: Taxable Income Event</strong>
                  <div style="margin: 8px 0; line-height: 1.5;">
                    Staking rewards are taxable as ordinary income at FMV upon receipt.
                    <br><br>
                    <strong>Tax treatment applied:</strong><br>
                    ‚Ä¢ Income: $187.36<br>
                    ‚Ä¢ Cost basis: $187.36<br>
                    ‚Ä¢ Date: 2024-01-11
                  </div>
                  <div class="resolution-actions">
                    <button class="resolution-btn primary" onclick="resolveAnomaly(this, 'confirm')">Confirm</button>
                  </div>
                </div>
              </div>
            </div>
            <div style="text-align: right;">03:42</div>
            <div>
              <button onclick="viewDetails()" style="padding: 6px 12px; font-size: 12px;">Details</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>¬© 2025 Computis ‚Ä¢ Design Element Showcase</footer>
    <div class="toast-area" aria-live="polite"></div>

    <script src="../assets/app.js"></script>
    <script>
      function filterAnomalies(severity) {
        document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
        event.target.classList.add('active');
        
        document.querySelectorAll('.transaction-row').forEach(row => {
          if (severity === 'all' || row.dataset.severity === severity) {
            row.style.display = 'grid';
          } else {
            row.style.display = 'none';
          }
        });
        
        toast(`Filtered to ${severity === 'all' ? 'all' : severity} anomalies`);
      }

      function resolveAnomaly(btn, action) {
        const row = btn.closest('.transaction-row');
        row.classList.add('resolved');
        row.classList.remove('has-anomaly');
        
        const flag = row.querySelector('.anomaly-flag');
        flag.innerHTML = '‚úì Resolved';
        flag.className = 'anomaly-flag';
        flag.style.background = 'rgba(34, 197, 94, 0.15)';
        flag.style.color = '#22c55e';
        flag.style.border = '1px solid rgba(34, 197, 94, 0.3)';
        
        toast(`Anomaly resolved: ${action}`);
        
        updateStats();
      }

      function updateStats() {
        const critical = document.querySelectorAll('[data-severity="critical"]:not(.resolved)').length;
        const warning = document.querySelectorAll('[data-severity="warning"]:not(.resolved)').length;
        const info = document.querySelectorAll('[data-severity="info"]:not(.resolved)').length;
        const resolved = document.querySelectorAll('.resolved').length;
        
        document.querySelector('.anomaly-stats').children[0].querySelector('div:nth-child(2)').textContent = critical;
        document.querySelector('.anomaly-stats').children[1].querySelector('div:nth-child(2)').textContent = warning;
        document.querySelector('.anomaly-stats').children[2].querySelector('div:nth-child(2)').textContent = info;
        document.querySelector('.anomaly-stats').children[3].querySelector('div:nth-child(2)').textContent = resolved;
      }

      function viewDetails() {
        toast('Opening transaction details...');
      }
    </script>
  </body>
</html>
