<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Computis • Visual Rule Builder</title>
    <link rel="stylesheet" href="../assets/styles.css" />
    <style>
      .builder-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 24px;
      }
      .rule-builder {
        background: #161b26;
        border: 1px solid #2a3447;
        border-radius: 8px;
        padding: 20px;
      }
      .condition-group {
        background: #0b0f1a;
        border: 1px solid #2a3447;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 12px;
      }
      .condition-row {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-bottom: 8px;
      }
      .condition-row select,
      .condition-row input {
        flex: 1;
        background: #161b26;
        border: 1px solid #2a3447;
        color: #e5e7eb;
        padding: 8px;
        border-radius: 4px;
      }
      .add-condition {
        background: rgba(99, 102, 241, 0.1);
        border: 1px dashed #6366f1;
        color: #6366f1;
        padding: 8px;
        border-radius: 4px;
        cursor: pointer;
        text-align: center;
        font-size: 13px;
        margin-top: 8px;
      }
      .action-selector {
        background: #0b0f1a;
        border: 1px solid #2a3447;
        border-radius: 6px;
        padding: 16px;
        margin-top: 16px;
      }
      .preview-pane {
        background: #161b26;
        border: 1px solid #2a3447;
        border-radius: 8px;
        padding: 20px;
      }
      .preview-comparison {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-top: 16px;
      }
      .preview-section {
        background: #0b0f1a;
        border: 1px solid #2a3447;
        border-radius: 6px;
        padding: 12px;
      }
      .preview-label {
        font-size: 12px;
        color: #9ca3af;
        margin-bottom: 8px;
        font-weight: 500;
        text-transform: uppercase;
      }
      .preview-item {
        padding: 8px;
        background: #161b26;
        border-radius: 4px;
        margin-bottom: 6px;
        font-size: 13px;
      }
      .preview-item.highlighted {
        background: rgba(99, 102, 241, 0.15);
        border: 1px solid #6366f1;
      }
      .rule-summary {
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid #6366f1;
        border-radius: 6px;
        padding: 12px;
        margin: 16px 0;
        font-size: 14px;
        line-height: 1.6;
      }
      .drag-handle {
        cursor: grab;
        color: #9ca3af;
        padding: 4px;
      }
      .drag-handle:active {
        cursor: grabbing;
      }
      .stats-bar {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
        padding: 12px;
        background: rgba(99, 102, 241, 0.05);
        border-radius: 6px;
      }
      .stat-item {
        flex: 1;
        text-align: center;
      }
      .stat-value {
        font-size: 20px;
        font-weight: 600;
        color: #6366f1;
      }
      .stat-label {
        font-size: 12px;
        color: #9ca3af;
        margin-top: 4px;
      }
    </style>
  </head>
  <body>
    <header class="app-header">
      <div class="inner container">
        <a class="brand" href="index.html"
          ><span class="logo"></span><span class="label">Computis</span></a
        >
        <nav class="nav">
          <a href="index.html">Dashboard</a>
          <a href="ai-confidence-chips.html">AI Confidence</a>
          <a href="audit-trail-drawer.html">Audit Trail</a>
          <a href="visual-rule-builder.html">Rule Builder</a>
          <a href="contextual-anomaly-detection.html">Anomaly Detection</a>
          <a href="multi-tenant-architecture.html">Multi-Tenant</a>
        </nav>
      </div>
    </header>

    <main class="container" aria-labelledby="title">
      <h1 id="title">Visual Rule Builder with Before/After Preview</h1>

      <section class="card" style="margin-bottom: 24px">
        <h3>Design Element Overview</h3>
        <p style="color: #9ca3af; line-height: 1.6">
          <strong>Problem:</strong> CPAs needed engineers to codify
          classification logic, creating bottlenecks and reducing autonomy.<br /><br />
          <strong>Solution:</strong> Drag-and-drop rule builder with natural
          language logic, before/after preview, and bulk application
          controls.<br /><br />
          <strong>Impact:</strong> Reduced engineering dependency by 85%;
          enabled scaling to hedge funds and DAOs with custom classification
          needs.
        </p>
      </section>

      <div class="builder-grid">
        <div class="rule-builder">
          <h3 style="margin-bottom: 16px">Build Rule</h3>

          <div class="condition-group">
            <div
              style="
                font-size: 13px;
                font-weight: 500;
                margin-bottom: 12px;
                color: #9ca3af;
              "
            >
              WHEN these conditions are met:
            </div>

            <div class="condition-row" id="condition-1">
              <span class="drag-handle">⋮⋮</span>
              <select id="field-1" onchange="updatePreview()">
                <option>Transaction Type</option>
                <option>Amount</option>
                <option>Asset</option>
                <option>Exchange</option>
                <option>Date Range</option>
              </select>
              <select id="operator-1" onchange="updatePreview()">
                <option>equals</option>
                <option>contains</option>
                <option>greater than</option>
                <option>less than</option>
              </select>
              <input
                type="text"
                id="value-1"
                placeholder="value"
                value="Swap"
                oninput="updatePreview()"
              />
              <button
                onclick="removeCondition(1)"
                style="
                  background: rgba(239, 68, 68, 0.2);
                  color: #ef4444;
                  border: none;
                  padding: 8px 12px;
                  border-radius: 4px;
                  cursor: pointer;
                "
              >
                ×
              </button>
            </div>

            <div class="condition-row" id="condition-2">
              <span class="drag-handle">⋮⋮</span>
              <select id="field-2" onchange="updatePreview()">
                <option>Amount</option>
                <option>Transaction Type</option>
                <option>Asset</option>
                <option>Exchange</option>
              </select>
              <select id="operator-2" onchange="updatePreview()">
                <option>greater than</option>
                <option>equals</option>
                <option>contains</option>
                <option>less than</option>
              </select>
              <input
                type="text"
                id="value-2"
                placeholder="value"
                value="10000"
                oninput="updatePreview()"
              />
              <button
                onclick="removeCondition(2)"
                style="
                  background: rgba(239, 68, 68, 0.2);
                  color: #ef4444;
                  border: none;
                  padding: 8px 12px;
                  border-radius: 4px;
                  cursor: pointer;
                "
              >
                ×
              </button>
            </div>

            <div class="add-condition" onclick="addCondition()">
              + Add Condition
            </div>
          </div>

          <div class="action-selector">
            <div
              style="
                font-size: 13px;
                font-weight: 500;
                margin-bottom: 12px;
                color: #9ca3af;
              "
            >
              THEN apply this action:
            </div>
            <select
              id="action"
              onchange="updatePreview()"
              style="
                width: 100%;
                background: #161b26;
                border: 1px solid #2a3447;
                color: #e5e7eb;
                padding: 10px;
                border-radius: 4px;
                margin-bottom: 8px;
              "
            >
              <option>Flag for Review</option>
              <option>Auto-classify as...</option>
              <option>Set Cost Basis Method</option>
              <option>Apply Tax Treatment</option>
              <option>Add to Report</option>
            </select>
            <input
              type="text"
              id="action-value"
              placeholder="Action details..."
              value="Large Trade"
              oninput="updatePreview()"
              style="
                width: 100%;
                background: #161b26;
                border: 1px solid #2a3447;
                color: #e5e7eb;
                padding: 10px;
                border-radius: 4px;
              "
            />
          </div>

          <div class="rule-summary" id="rule-summary">
            <strong>Rule Summary:</strong><br />
            When <strong>Transaction Type</strong> equals
            "<strong>Swap</strong>" AND <strong>Amount</strong> greater than
            "<strong>10000</strong>", then <strong>Flag for Review</strong> as
            "<strong>Large Trade</strong>"
          </div>

          <div style="display: flex; gap: 8px; margin-top: 16px">
            <button class="primary" style="flex: 1" onclick="applyRule()">
              Apply Rule
            </button>
            <button style="flex: 1" onclick="testRule()">
              Test on Sample Data
            </button>
          </div>
        </div>

        <div class="preview-pane">
          <h3 style="margin-bottom: 8px">Live Preview</h3>
          <div class="stats-bar">
            <div class="stat-item">
              <div class="stat-value" id="matches-count">3</div>
              <div class="stat-label">Matches</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="affected-count">3</div>
              <div class="stat-label">Will Be Affected</div>
            </div>
          </div>

          <div class="preview-comparison">
            <div class="preview-section">
              <div class="preview-label">Before Rule</div>
              <div id="before-preview">
                <div class="preview-item">
                  BTC → ETH Swap<br />
                  <span style="color: #9ca3af; font-size: 12px"
                    >$15,000 • No flags</span
                  >
                </div>
                <div class="preview-item">
                  USDC → SOL Swap<br />
                  <span style="color: #9ca3af; font-size: 12px"
                    >$12,500 • No flags</span
                  >
                </div>
                <div class="preview-item">
                  ETH → USDT Swap<br />
                  <span style="color: #9ca3af; font-size: 12px"
                    >$8,200 • No flags</span
                  >
                </div>
                <div class="preview-item">
                  BTC → USDC Swap<br />
                  <span style="color: #9ca3af; font-size: 12px"
                    >$22,000 • No flags</span
                  >
                </div>
              </div>
            </div>

            <div class="preview-section">
              <div class="preview-label">After Rule</div>
              <div id="after-preview">
                <div class="preview-item highlighted">
                  BTC → ETH Swap<br />
                  <span style="color: #9ca3af; font-size: 12px">$15,000</span
                  ><br />
                  <span class="badge warn" style="margin-top: 4px"
                    >🚩 Large Trade</span
                  >
                </div>
                <div class="preview-item highlighted">
                  USDC → SOL Swap<br />
                  <span style="color: #9ca3af; font-size: 12px">$12,500</span
                  ><br />
                  <span class="badge warn" style="margin-top: 4px"
                    >🚩 Large Trade</span
                  >
                </div>
                <div class="preview-item">
                  ETH → USDT Swap<br />
                  <span style="color: #9ca3af; font-size: 12px"
                    >$8,200 • No flags</span
                  >
                </div>
                <div class="preview-item highlighted">
                  BTC → USDC Swap<br />
                  <span style="color: #9ca3af; font-size: 12px">$22,000</span
                  ><br />
                  <span class="badge warn" style="margin-top: 4px"
                    >🚩 Large Trade</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <section class="card">
        <h3>Active Rules</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Rule Name</th>
                <th>Conditions</th>
                <th>Action</th>
                <th>Matches</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Large Swap Flagging</td>
                <td>Type = Swap AND Amount > $10k</td>
                <td>Flag for Review: Large Trade</td>
                <td>3</td>
                <td><span class="badge success">Active</span></td>
                <td>
                  <button style="padding: 4px 8px; font-size: 12px">
                    Edit
                  </button>
                  <button
                    style="padding: 4px 8px; font-size: 12px; margin-left: 4px"
                  >
                    Disable
                  </button>
                </td>
              </tr>
              <tr>
                <td>NFT Tax Treatment</td>
                <td>Type = NFT Purchase</td>
                <td>Set Tax Treatment: Collectible</td>
                <td>12</td>
                <td><span class="badge success">Active</span></td>
                <td>
                  <button style="padding: 4px 8px; font-size: 12px">
                    Edit
                  </button>
                  <button
                    style="padding: 4px 8px; font-size: 12px; margin-left: 4px"
                  >
                    Disable
                  </button>
                </td>
              </tr>
              <tr>
                <td>Staking Rewards Classification</td>
                <td>Source = Beacon Chain</td>
                <td>Auto-classify: Staking Income</td>
                <td>45</td>
                <td><span class="badge success">Active</span></td>
                <td>
                  <button style="padding: 4px 8px; font-size: 12px">
                    Edit
                  </button>
                  <button
                    style="padding: 4px 8px; font-size: 12px; margin-left: 4px"
                  >
                    Disable
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer>© 2025 Computis • Design Element Showcase</footer>
    <div class="toast-area" aria-live="polite"></div>

    <script src="../assets/app.js"></script>
    <script>
      function updatePreview() {
        const field1 = document.getElementById("field-1").value;
        const operator1 = document.getElementById("operator-1").value;
        const value1 = document.getElementById("value-1").value;
        const field2 = document.getElementById("field-2").value;
        const operator2 = document.getElementById("operator-2").value;
        const value2 = document.getElementById("value-2").value;
        const action = document.getElementById("action").value;
        const actionValue = document.getElementById("action-value").value;

        document.getElementById("rule-summary").innerHTML = `
          <strong>Rule Summary:</strong><br>
          When <strong>${field1}</strong> ${operator1} "<strong>${value1}</strong>" AND <strong>${field2}</strong> ${operator2} "<strong>${value2}</strong>", then <strong>${action}</strong> as "<strong>${actionValue}</strong>"
        `;

        const threshold = parseInt(value2) || 10000;
        const matches = [15000, 12500, 22000].filter(
          (v) => v > threshold,
        ).length;
        document.getElementById("matches-count").textContent = matches;
        document.getElementById("affected-count").textContent = matches;
      }

      function addCondition() {
        toast("New condition added");
      }

      function removeCondition(id) {
        toast(`Condition ${id} removed`);
      }

      function applyRule() {
        toast("Rule applied to 3 transactions");
      }

      function testRule() {
        toast("Testing rule on sample dataset...");
        setTimeout(() => toast("Test complete: 3 matches found"), 1000);
      }
    </script>
  </body>
</html>
